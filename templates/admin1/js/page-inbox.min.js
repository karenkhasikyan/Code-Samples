var inbox={inboxContent:$("#inbox-content"),pageTitle:$(".page-title"),fileInboxList:"page-inbox-list.html",fileInboxMessage:"page-inbox-message.html",fileInboxReply:"page-inbox-reply.html",fileInboxListSent:"page-inbox-list-sent.html",fileInboxListSpam:"page-inbox-list-spam.html",fileInboxListTrash:"page-inbox-list-trash.html",fileInboxListStarred:"page-inbox-list-starred.html",cc:'<div class="form-group"><div class="input-group"><span class="input-group-addon">CC: </span><input type="text" class="form-control" name="cc"><span class="input-group-addon"><i class="icon-close" data-action="cc-close"></i></span></div></div>',bcc:'<div class="form-group"><div class="input-group"><span class="input-group-addon">BCC: </span><input type="text" class="form-control" name="bcc"><span class="input-group-addon"><i class="icon-close" data-action="bcc-close"></i></span></div></div>',init:function(){$.ajax({url:inbox.fileInboxList,datatype:"html",cache:!1,success:function(n,t,e){inbox.inboxContent.append(n),inbox.icheckInit(),inbox.paginationInit(),$(document).on("click",".nav-inbox [data-action]",inbox.navInbox).on("click",".table-inbox-list tr",inbox.message).on("click","#inbox-content .star",inbox.starIconClick).on("ifChanged",".inbox-list-heading .icheck",inbox.icheckClick).on("click",".inbox-list-heading [data-action]",inbox.tableRefresh)},error:function(){alert("Unable to load inbox list")}})},tableRefresh:function(n){var t=$(n.target).attr("data-action"),e,i;e=window.location.pathname,e=e.split("/"),i=e[e.length-1],file=i.indexOf("."),file=i.slice(0,file),"btn-refresh"==t&&(inbox.blockuiInit(),setTimeout(function(){inbox.navInboxActivePage(file)},2e3))},blockuiInit:function(){$.blockUI.defaults.timeout=2e3,$.blockUI.defaults.overlayCSS.zIndex=1060,$.blockUI.defaults.overlayCSS.backgroundColor="transparent",$.blockUI.defaults.css.width="auto",$.blockUI.defaults.css.left=0,$.blockUI.defaults.css.right=0,$.blockUI.defaults.css.margin="auto",$.blockUI.defaults.css.border="none",$.blockUI.defaults.css.backgroundColor="transparent",$(".table-inbox-list").block({message:'<i class="fa fa-spinner fa-spin" style="font-size: 30px"></i>',overlayCSS:{"background-color":"#eee"}})},icheckInit:function(){$("input.icheck").iCheck({checkboxClass:"icheckbox_minimal-grey",radioClass:"iradio_minimal-grey"})},icheckClick:function(){$(this).on("ifChecked ifUnchecked",function(n){"ifChecked"==n.type?$(".table-inbox-list .icheck").iCheck("check"):$(".table-inbox-list .icheck").iCheck("uncheck")})},paginationInit:function(){$(".content-wrapper").jplist({itemsBox:".table-inbox-list",itemPath:"tr[data-id]",panelPath:".inbox-list-pagination"})},attachmentInit:function(){$(".attachment-img").magnificPopup({delegate:"a:not(.attachment-item-file)",type:"image",gallery:{enabled:!0}}),$(".attachment-file").magnificPopup({delegate:".attachment-item-file",type:"iframe"})},summernoteInit:function(){$("[data-content='message-editor']").summernote()},starIconClick:function(n){var t=$(this).find(".fa");t.closest("tr")&&(n.stopPropagation(),t.hasClass("fa-star-o")?t.removeClass("fa-star-o").addClass("fa-star"):t.removeClass("fa-star").addClass("fa-star-o"))},message:function(){var n=$(this).attr("data-id");$.ajax({url:inbox.fileInboxMessage,datatype:"html",cache:!1,success:function(t,e,i){inbox.inboxContent.empty();var a=$($.parseHTML(t)).find(".panel[data-id='"+n+"']");inbox.inboxContent.append(a),inbox.attachmentInit(),inbox.inboxContent.find("[data-action='btn-reply']").on("click",inbox.reply)},error:function(){alert("Unable to load the current message")}})},reply:function(){$.ajax({url:inbox.fileInboxReply,datatype:"html",cache:!1,success:function(n,t,e){var i=inbox.inboxContent.find("[data-content='recipient']").text(),a=inbox.inboxContent.find("[data-content='subject']").text(),o=inbox.inboxContent.find("[data-content='message']").html();inbox.inboxContent.empty(),inbox.inboxContent.append(n),inbox.inboxContent.find(".panel-title > h4").text("Reply"),inbox.inboxContent.find("input[type='text'][data-content='recipient']").val(i),inbox.inboxContent.find("input[type='text'][data-content='subject']").val(a),inbox.inboxContent.find("div[data-content='message-editor']").html(o),inbox.summernoteInit(),inbox.fileUpload(),$(document).on("click",".message-reply-heading [data-action]",inbox.ccbcc)},error:function(){alert("Unable to load the reply form")}})},ccbcc:function(){var n=$(this).closest(".message-reply-heading"),t=$(this).attr("data-action");if("cc"!=t||n.hasClass("has-cc")||n.append(inbox.cc).addClass("has-cc"),"bcc"!=t||n.hasClass("has-bcc")||n.append(inbox.bcc).addClass("has-bcc"),"cc-close"==t||"bcc-close"==t){var e=t.indexOf("-");e=t.slice(0,e),$(this).closest(".form-group").remove(),n.removeClass("has-"+e)}},navInbox:function(n){$(n.target).closest("li").addClass("active").siblings().removeClass("active"),inbox.navItem=$(n.target).attr("data-action")||$(n.target).closest("[data-action]").attr("data-action"),inbox.navInboxActivePage(inbox.navItem)},navInboxActivePage:function(n){switch(n){case"compose":inbox.compose();break;case"inbox":inbox.inbox();break;case"sent":inbox.sent();break;case"spam":inbox.spam();break;case"trash":inbox.trash();break;case"starred":inbox.starred()}},compose:function(){$.ajax({url:inbox.fileInboxReply,datatype:"html",cache:!1,success:function(n,t,e){inbox.pageTitle.text("Compose"),inbox.inboxContent.empty().append(n),inbox.inboxContent.find(".panel-title > h4").text("New message"),inbox.summernoteInit(),inbox.fileUpload(),$(document).on("click",".message-reply-heading [data-action]",inbox.ccbcc)},error:function(){alert("Unable to compose a message")}})},inbox:function(){$.ajax({url:inbox.fileInboxList,datatype:"html",cache:!1,success:function(n,t,e){inbox.pageTitle.text("Inbox"),inbox.inboxContent.empty().append(n),inbox.icheckInit(),inbox.paginationInit()},error:function(){alert("Unable to load sent messages")}})},sent:function(){$.ajax({url:inbox.fileInboxListSent,datatype:"html",cache:!1,success:function(n,t,e){inbox.pageTitle.text("Sent"),inbox.inboxContent.empty().append(n),inbox.icheckInit(),inbox.paginationInit()},error:function(){alert("Unable to load sent messages")}})},spam:function(){$.ajax({url:inbox.fileInboxListSpam,datatype:"html",cache:!1,success:function(n,t,e){inbox.pageTitle.text("Spam"),inbox.inboxContent.empty().append(n),inbox.icheckInit(),inbox.paginationInit()},error:function(){alert("Unable to load messages")}})},trash:function(){$.ajax({url:inbox.fileInboxListTrash,datatype:"html",cache:!1,success:function(n,t,e){inbox.pageTitle.text("Trash"),inbox.inboxContent.empty().append(n),inbox.icheckInit(),inbox.paginationInit()},error:function(){alert("Unable to load messages")}})},starred:function(){$.ajax({url:inbox.fileInboxListStarred,datatype:"html",cache:!1,success:function(n,t,e){inbox.pageTitle.text("Starred"),inbox.inboxContent.empty().append(n),inbox.icheckInit(),inbox.paginationInit()},error:function(){alert("Unable to load messages")}})},fileUpload:function(){var n=document.querySelector("#template");n.id="";var t=n.parentNode.innerHTML;n.parentNode.removeChild(n);var e=new Dropzone(document.querySelector("#actions"),{url:"page-inbox.html",thumbnailWidth:150,thumbnailHeight:100,parallelUploads:20,previewTemplate:t,autoQueue:!1,previewsContainer:"#previews",clickable:".fileinput-button"});e.on("addedfile",function(n){n.previewElement.querySelector(".start").onclick=function(){e.enqueueFile(n)}}),document.querySelector("#actions .start").onclick=function(){e.enqueueFiles(e.getFilesWithStatus(Dropzone.ADDED))},document.querySelector("#actions .cancel").onclick=function(){e.removeAllFiles(!0)}}};!function($){"use strict";inbox.init()}(jQuery);